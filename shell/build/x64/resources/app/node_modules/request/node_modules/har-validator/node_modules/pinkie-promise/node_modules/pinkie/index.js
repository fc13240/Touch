"use strict";function asyncFlush(){for(var e=0;e<asyncQueue.length;e++)asyncQueue[e][0](asyncQueue[e][1]);asyncQueue=[],asyncTimer=!1}function asyncCall(e,t){asyncQueue.push([e,t]),asyncTimer||(asyncTimer=!0,asyncSetTimer(asyncFlush,0))}function invokeResolver(e,t){function n(e){resolve(t,e)}function o(e){reject(t,e)}try{e(n,o)}catch(r){o(r)}}function invokeCallback(e){var t=e.owner,n=t._state,o=t._data,r=e[n],i=e.then;if("function"==typeof r){n=FULFILLED;try{o=r(o)}catch(s){reject(i,s)}}handleThenable(i,o)||(n===FULFILLED&&resolve(i,o),n===REJECTED&&reject(i,o))}function handleThenable(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"==typeof t)){var o=t.then;if("function"==typeof o)return o.call(t,function(o){n||(n=!0,t===o?fulfill(e,o):resolve(e,o))},function(t){n||(n=!0,reject(e,t))}),!0}}catch(r){return n||reject(e,r),!0}return!1}function resolve(e,t){e!==t&&handleThenable(e,t)||fulfill(e,t)}function fulfill(e,t){e._state===PENDING&&(e._state=SETTLED,e._data=t,asyncCall(publishFulfillment,e))}function reject(e,t){e._state===PENDING&&(e._state=SETTLED,e._data=t,asyncCall(publishRejection,e))}function publish(e){e._then=e._then.forEach(invokeCallback)}function publishFulfillment(e){e._state=FULFILLED,publish(e)}function publishRejection(e){e._state=REJECTED,publish(e),!e._handled&&isNode&&global.process.emit("unhandledRejection",e._data,e)}function notifyRejectionHandled(e){global.process.emit("rejectionHandled",e)}function Promise(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(this instanceof Promise==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],invokeResolver(e,this)}var PENDING="pending",SETTLED="settled",FULFILLED="fulfilled",REJECTED="rejected",NOOP=function(){},isNode="undefined"!=typeof global&&"undefined"!=typeof global.process&&"function"==typeof global.process.emit,asyncSetTimer="undefined"==typeof setImmediate?setTimeout:setImmediate,asyncQueue=[],asyncTimer;Promise.prototype={constructor:Promise,_state:PENDING,_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(NOOP),fulfilled:e,rejected:t};return!t&&!e||this._handled||(this._handled=!0,this._state===REJECTED&&isNode&&asyncCall(notifyRejectionHandled,this)),this._state===FULFILLED||this._state===REJECTED?asyncCall(invokeCallback,n):this._then.push(n),n.then},"catch":function(e){return this.then(null,e)}},Promise.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new Promise(function(t,n){function o(e){return s++,function(n){i[e]=n,--s||t(i)}}for(var r,i=[],s=0,a=0;a<e.length;a++)r=e[a],r&&"function"==typeof r.then?r.then(o(a),n):i[a]=r;s||t(i)})},Promise.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new Promise(function(t,n){for(var o,r=0;r<e.length;r++)o=e[r],o&&"function"==typeof o.then?o.then(t,n):t(o)})},Promise.resolve=function(e){return e&&"object"==typeof e&&e.constructor===Promise?e:new Promise(function(t){t(e)})},Promise.reject=function(e){return new Promise(function(t,n){n(e)})},module.exports=Promise;