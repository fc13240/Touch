!function(){function t(e){try{var i=a.dirname(e);return n.existsSync(i)||t(i),n.existsSync(e)||n.mkdirSync(e),!0}catch(r){}}function e(e,i){return i=i.substring(i.indexOf("base64,")+7),i=new Buffer(i,"base64"),t(a.dirname(e)),n.writeFileSync(e,i),i}function i(t,e){var i=c(t),r=a.join(o.tmpDir(),"cwtv","map",i,e.z+"",e.x+"",e.y+".png");return r}function r(t,e,r,a){var s=t,o=new Image,u=/^http/.test(t),c=!1;if(u){var h=i(e,r);n.existsSync(h)&&(s=t=h,c=!0,console.log("_cachePath = ",h))}return o.onload=function(){u&&!c&&(console.log("loadimage = ",t),l(h,o)),a&&a.call(this,s)},o.crossOrigin="",o.src=t,s}if(is_native){var n=require("fs"),a=require("path"),s=require("crypto"),o=require("os"),l=function(){var t=L.DomUtil.create("canvas"),i=t.getContext("2d");return function(r,n,a,s){t.width=n.width,t.height=n.height,i.drawImage(n,0,0);var o=t.toDataURL("image/png"),l=e(r,o);a&&a(s?l:o)}}(),u="cwtv",c=function(t,e){return t&&t.toString?s.createHash("sha1").update(t.toString()+(e||u)).digest("hex"):""};L.TileLayer.Multi.include({getTileUrl:function(t){var e=this._getZoomForUrl(),r=this._tileDefs[e];this._adjustTilePoint(t);var a=L.extend({s:this._getSubdomain(t,r.subdomains),z:e,x:t.x,y:t.y},this.options),s=i(r.url,a);if(n.existsSync(s))return console.log("_cachePath = ",s),s;var o=L.Util.template(r.url,a);return o},_loadTile:function(t,e){var i=this;t._layer=this,t.onerror=this._tileOnError,i._adjustTilePoint(e);var n=i.getTileUrl(e),a=i._getZoomForUrl(),s=i._tileDefs[a];i._adjustTilePoint(e);var o=L.extend({s:i._getSubdomain(e,s.subdomains),z:a,x:e.x,y:e.y},i.options);r(n,s.url,o,function(e){t.src=e,i._tileOnLoad.apply(t)}),i.fire("tileloadstart",{tile:t,url:n})}}),Util.TileLayer={cache:function(t,e){t.prototype.requestImage=function(t,i,n){var a=t,s=i,o=n;if(n<this.minimumLevel||n>this.maximumLevel)return this.sb;var l=this.url.replace("{z}",n.toFixed(0)),l=l.replace("{x}",t.toFixed(0)),l=l.replace("{y}",(this.Lc?(1<<n)-i-1:i).toFixed(0)),u=this.Sb[e(t+i+n,this.Sb.length)];0<this.Sb.length&&(l=l.replace("{sub}",u)),t=this.Ja?this.Ja.getURL(l):l;var c=$.Deferred();return r(t,this.url.replace("{sub}","{s}"),{s:u,x:a,y:s,z:o},function(){c.resolve(this)}),c}}}}}();