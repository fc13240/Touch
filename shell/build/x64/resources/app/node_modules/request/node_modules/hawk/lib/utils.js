var Sntp=require("sntp"),Boom=require("boom"),internals={};exports.version=function(){return require("../package.json").version},exports.limits={maxMatchLength:4096},internals.hostHeaderRegex=/^(?:(?:\r\n)?\s)*((?:[^:]+)|(?:\[[^\]]+\]))(?::(\d+))?(?:(?:\r\n)?\s)*$/,exports.parseHost=function(e,t){t=t?t.toLowerCase():"host";var r=e.headers[t];if(!r)return null;if(r.length>exports.limits.maxMatchLength)return null;var n=r.match(internals.hostHeaderRegex);return n?{name:n[1],port:n[2]?n[2]:e.connection&&e.connection.encrypted?443:80}:null},exports.parseContentType=function(e){return e?e.split(";")[0].trim().toLowerCase():""},exports.parseRequest=function(e,t){if(!e.headers)return e;var r;if(!(t.host&&t.port||(r=exports.parseHost(e,t.hostHeaderName))))return new Error("Invalid Host header");var n={method:e.method,url:e.url,host:t.host||r.name,port:t.port||r.port,authorization:e.headers.authorization,contentType:e.headers["content-type"]||""};return n},exports.now=function(e){return Sntp.now()+(e||0)},exports.nowSecs=function(e){return Math.floor(exports.now(e)/1e3)},internals.authHeaderRegex=/^(\w+)(?:\s+(.*))?$/,internals.attributeRegex=/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~]+$/,exports.parseAuthorizationHeader=function(e,t){if(t=t||["id","ts","nonce","hash","ext","mac","app","dlg"],!e)return Boom.unauthorized(null,"Hawk");if(e.length>exports.limits.maxMatchLength)return Boom.badRequest("Header length too long");var r=e.match(internals.authHeaderRegex);if(!r)return Boom.badRequest("Invalid header syntax");var n=r[1];if("hawk"!==n.toLowerCase())return Boom.unauthorized(null,"Hawk");var o=r[2];if(!o)return Boom.badRequest("Invalid header syntax");var a={},s="",i=o.replace(/(\w+)="([^"\\]*)"\s*(?:,\s*|$)/g,function(e,r,n){return-1===t.indexOf(r)?void(s="Unknown attribute: "+r):null===n.match(internals.attributeRegex)?void(s="Bad attribute value: "+r):a.hasOwnProperty(r)?void(s="Duplicate attribute: "+r):(a[r]=n,"")});return""!==i?Boom.badRequest(s||"Bad header format"):a},exports.unauthorized=function(e,t){return Boom.unauthorized(e,"Hawk",t)};