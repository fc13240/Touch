var Crypto=require("crypto"),Url=require("url"),Utils=require("./utils"),internals={};exports.headerVersion="1",exports.algorithms=["sha1","sha256"],exports.calculateMac=function(e,a,r){var t=exports.generateNormalizedString(e,r),n=Crypto.createHmac(a.algorithm,a.key).update(t),s=n.digest("base64");return s},exports.generateNormalizedString=function(e,a){var r=a.resource||"";if(r&&"/"!==r[0]){var t=Url.parse(r,!1);r=t.path}var n="hawk."+exports.headerVersion+"."+e+"\n"+a.ts+"\n"+a.nonce+"\n"+(a.method||"").toUpperCase()+"\n"+r+"\n"+a.host.toLowerCase()+"\n"+a.port+"\n"+(a.hash||"")+"\n";return a.ext&&(n+=a.ext.replace("\\","\\\\").replace("\n","\\n")),n+="\n",a.app&&(n+=a.app+"\n"+(a.dlg||"")+"\n"),n},exports.calculatePayloadHash=function(e,a,r){var t=exports.initializePayloadHash(a,r);return t.update(e||""),exports.finalizePayloadHash(t)},exports.initializePayloadHash=function(e,a){var r=Crypto.createHash(e);return r.update("hawk."+exports.headerVersion+".payload\n"),r.update(Utils.parseContentType(a)+"\n"),r},exports.finalizePayloadHash=function(e){return e.update("\n"),e.digest("base64")},exports.calculateTsMac=function(e,a){var r=Crypto.createHmac(a.algorithm,a.key);return r.update("hawk."+exports.headerVersion+".ts\n"+e+"\n"),r.digest("base64")},exports.timestampMessage=function(e,a){var r=Utils.nowSecs(a),t=exports.calculateTsMac(r,e);return{ts:r,tsm:t}};