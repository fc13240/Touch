function sha1(r,e){return crypto.createHmac("sha1",r).update(e).digest("base64")}function rsa(r,e){return crypto.createSign("RSA-SHA1").update(e).sign(r,"base64")}function rfc3986(r){return encodeURIComponent(r).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/'/g,"%27")}function map(r){var e,n,a=[];for(e in r)if(n=r[e],Array.isArray(n))for(var t=0;t<n.length;t++)a.push([e,n[t]]);else if("object"==typeof n)for(var s in n)a.push([e+"["+s+"]",n[s]]);else a.push([e,n]);return a}function compare(r,e){return r>e?1:e>r?-1:0}function generateBase(r,e,n){var a=map(n).map(function(r){return[rfc3986(r[0]),rfc3986(r[1]||"")]}).sort(function(r,e){return compare(r[0],e[0])||compare(r[1],e[1])}).map(function(r){return r.join("=")}).join("&"),t=[rfc3986(r?r.toUpperCase():"GET"),rfc3986(e),rfc3986(a)].join("&");return t}function hmacsign(r,e,n,a,t){var s=generateBase(r,e,n),c=[a||"",t||""].map(rfc3986).join("&");return sha1(c,s)}function rsasign(r,e,n,a){var t=generateBase(r,e,n),s=a||"";return rsa(s,t)}function plaintext(r,e){var n=[r||"",e||""].map(rfc3986).join("&");return n}function sign(r){var e,n=1;switch(r){case"RSA-SHA1":e=rsasign;break;case"HMAC-SHA1":e=hmacsign;break;case"PLAINTEXT":e=plaintext,n=4;break;default:throw new Error("Signature method not supported: "+r)}return e.apply(null,[].slice.call(arguments,n))}var crypto=require("crypto"),qs=require("querystring");exports.hmacsign=hmacsign,exports.rsasign=rsasign,exports.plaintext=plaintext,exports.sign=sign,exports.rfc3986=rfc3986,exports.generateBase=generateBase;