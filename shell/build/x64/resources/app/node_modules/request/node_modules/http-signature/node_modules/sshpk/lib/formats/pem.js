function read(e,r){var s=e;"string"!=typeof e&&(assert.buffer(e,"buf"),e=e.toString("ascii"));var t=e.trim().split("\n"),a=t[0].match(/[-]+[ ]*BEGIN ([A-Z0-9]+ )?(PUBLIC|PRIVATE) KEY[ ]*[-]+/);assert.ok(a,"invalid PEM header");var i=t[t.length-1].match(/[-]+[ ]*END ([A-Z0-9]+ )?(PUBLIC|PRIVATE) KEY[ ]*[-]+/);assert.ok(i,"invalid PEM footer"),assert.equal(a[2],i[2]);var c,n=a[2].toLowerCase();a[1]&&(assert.equal(a[1],i[1],"PEM header and footer mismatch"),c=a[1].trim());for(var o={};;){if(t=t.slice(1),a=t[0].match(/^([A-Za-z0-9-]+): (.+)$/),!a)break;o[a[1].toLowerCase()]=a[2]}if(o["proc-type"]){var p=o["proc-type"].split(",");if("4"===p[0]&&"ENCRYPTED"===p[1])throw new Error("PEM key is encrypted (password-protected). Please use the SSH agent or decrypt the key.")}if(t=t.slice(0,-1).join(""),e=new Buffer(t,"base64"),c&&"openssh"===c.toLowerCase())return sshpriv.readSSHPrivate(n,e);if(c&&"ssh2"===c.toLowerCase())return rfc4253.readType(n,e);var u=new asn1.BerReader(e);return u.originalInput=s,u.readSequence(),c?(r&&assert.strictEqual(r,"pkcs1"),pkcs1.readPkcs1(c,n,u)):(r&&assert.strictEqual(r,"pkcs8"),pkcs8.readPkcs8(c,n,u))}function write(e,r){assert.object(e);var s,t={ecdsa:"EC",rsa:"RSA",dsa:"DSA"}[e.type],a=new asn1.BerWriter;if(PrivateKey.isPrivateKey(e))r&&"pkcs8"===r?(s="PRIVATE KEY",pkcs8.writePkcs8(a,e)):(r&&assert.strictEqual(r,"pkcs1"),s=t+" PRIVATE KEY",pkcs1.writePkcs1(a,e));else{if(!Key.isKey(e))throw new Error("key is not a Key or PrivateKey");r&&"pkcs1"===r?(s=t+" PUBLIC KEY",pkcs1.writePkcs1(a,e)):(r&&assert.strictEqual(r,"pkcs8"),s="PUBLIC KEY",pkcs8.writePkcs8(a,e))}var i=a.buffer.toString("base64"),c=i.length+i.length/64+18+16+2*s.length+10,n=new Buffer(c),o=0;o+=n.write("-----BEGIN "+s+"-----\n",o);for(var p=0;p<i.length;){var u=p+64;u>i.length&&(u=i.length),o+=n.write(i.slice(p,u),o),n[o++]=10,p=u}return o+=n.write("-----END "+s+"-----\n",o),n.slice(0,o)}module.exports={read:read,write:write};var assert=require("assert-plus"),asn1=require("asn1"),algs=require("../algs"),utils=require("../utils"),Key=require("../key"),PrivateKey=require("../private-key"),pkcs1=require("./pkcs1"),pkcs8=require("./pkcs8"),sshpriv=require("./ssh-private"),rfc4253=require("./rfc4253");