$(function(){function n(n){var a={unique:!1,loading:!1},i=t("http://decision.tianqi.cn/data/cmaalarm/index.html",a),o=t("http://decision.tianqi.cn/alarm/grepalarmBox.php?areaid=[\\d]{5,7}",a);e.req(),$.when(i,o).done(function(a,i){e.hide();var t=[],o=i[0].data;o&&$.each(o,function(n,a){t.push(r(a))}),n&&n(t)})}function a(n,a){i.closePopup(),t(n,function(n,t){L.popup({className:"alarm_detail box",maxWidth:500}).setLatLng(a).setContent('<div class="alarm_detail_title">'+t.PROVINCE+t.CITY+t.SIGNALTYPE+t.SIGNALLEVEL+'\u9884\u8b66</div><p class="alarm_detail_desc">'+t.ISSUECONTENT+"</p>").openOn(i)})}var i,t=Util.req,e=Util.Loading;W.require.bind(null,["maps"],function(n){i=n})();var r=function(){var n=["\u53f0\u98ce","\u66b4\u96e8","\u66b4\u96ea","\u5bd2\u6f6e","\u5927\u98ce","\u6c99\u5c18\u66b4","\u9ad8\u6e29","\u5e72\u65f1","\u96f7\u7535","\u51b0\u96f9","\u971c\u51bb","\u5927\u96fe","\u973e","\u9053\u8def\u7ed3\u51b0"],a=["\u5bd2\u51b7","\u7070\u973e","\u96f7\u96e8\u5927\u98ce","\u68ee\u6797\u706b\u9669","\u964d\u6e29","\u9053\u8def\u51b0\u96ea","\u5e72\u70ed\u98ce","\u4f4e\u6e29","\u51b0\u51bb"],i=["\u84dd\u8272","\u9ec4\u8272","\u6a59\u8272","\u7ea2\u8272"],t=["\u767d\u8272"],e=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})-(\d{2})(\d{2})\.html/;return function(r){var o=e.exec(r[1]),c={};if(o){var d=parseInt(o[7],10),l="";l=d>90?a[d-91]:n[d-1];var p="",s=parseInt(o[8],10);p=s>90?t[s-91]:i[s-1];var u="";u=p>90||d>90?"0000":o[7]+o[8],c.title=r[0]+"\u6c14\u8c61\u53f0\u53d1\u5e03"+l+p+"\u9884\u8b66",c.time=o[1]+"-"+o[2]+"-"+o[3]+" "+o[4]+":"+o[5]+":"+o[6],c.img="./img/waring/icon_warning_"+u+".png",c.url="http://decision.tianqi.cn/alarm/wapdata/"+r[1],c.gov=r[0],c.pos=[r[3],r[2]]}return c}}(),o=[];window.Alarm={init:function(){n(function(n){n&&$.each(n,function(n,t){var e=L.divIcon({className:"alarm_layer",html:'<img src="'+t.img+'"/>',iconSize:L.point(60,60)}),r=L.marker(t.pos,{icon:e,zIndexOffset:10}).addTo(i).on("click",function(){a(t.url,t.pos)});o.push(r)})})},clear:function(){i.closePopup();for(var n;n=o.shift();)i.removeLayer(n)}}});