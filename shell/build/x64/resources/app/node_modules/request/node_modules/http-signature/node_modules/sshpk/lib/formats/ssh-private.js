function read(e){return pem.read(e)}function readSSHPrivate(e,r){r=new SSHBuffer({buffer:r});var t=r.readCString();assert.strictEqual(t,MAGIC,"bad magic string");var a=r.readString(),i=r.readString();if("none"!==a||"none"!==i)throw new Error("OpenSSH-format key is encrypted (password-protected). Please use the SSH agent or decrypt the key.");r.readString();var n=r.readInt();if(1!==n)throw new Error("OpenSSH-format key file contains multiple keys: this is unsupported.");var f=r.readBuffer();if("public"===e)return assert.ok(r.atEnd(),"excess bytes left after key"),rfc4253.read(f);var s=r.readBuffer();assert.ok(r.atEnd(),"excess bytes left after key"),r=new SSHBuffer({buffer:s});var u=r.readInt(),o=r.readInt();assert.strictEqual(u,o,"checkints do not match");var S={},d=rfc4253.readInternal(S,"private",r.remainder());r.skip(S.consumed);var v=r.readString();return d.comment=v,d}function write(e){var r;r=PrivateKey.isPrivateKey(e)?e.toPublic():e;var t;if(PrivateKey.isPrivateKey(e)){t=new SSHBuffer({});var a=crypto.randomBytes(4).readUInt32BE(0);t.writeInt(a),t.writeInt(a),t.write(e.toBuffer("rfc4253")),t.writeString(e.comment||"");for(var i=1;t._offset%8!==0;)t.writeChar(i++)}var n=new SSHBuffer({});n.writeCString(MAGIC),n.writeString("none"),n.writeString("none"),n.writeBuffer(new Buffer(0)),n.writeInt(1),n.writeBuffer(r.toBuffer("rfc4253")),t&&n.writeBuffer(t.toBuffer()),n=n.toBuffer();var f;f=PrivateKey.isPrivateKey(e)?"OPENSSH PRIVATE KEY":"OPENSSH PUBLIC KEY";var s=n.toString("base64"),u=s.length+s.length/70+18+16+2*f.length+10;n=new Buffer(u);var o=0;o+=n.write("-----BEGIN "+f+"-----\n",o);for(var S=0;S<s.length;){var d=S+70;d>s.length&&(d=s.length),o+=n.write(s.slice(S,d),o),n[o++]=10,S=d}return o+=n.write("-----END "+f+"-----\n",o),n.slice(0,o)}module.exports={read:read,readSSHPrivate:readSSHPrivate,write:write};var assert=require("assert-plus"),asn1=require("asn1"),algs=require("../algs"),utils=require("../utils"),crypto=require("crypto"),Key=require("../key"),PrivateKey=require("../private-key"),pem=require("./pem"),rfc4253=require("./rfc4253"),SSHBuffer=require("../ssh-buffer"),MAGIC="openssh-key-v1";