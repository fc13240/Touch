var Code=require("code"),Hawk=require("../lib"),Lab=require("lab"),Package=require("../package.json"),internals={},lab=exports.lab=Lab.script(),describe=lab.experiment,it=lab.test,expect=Code.expect;describe("Utils",function(){describe("parseHost()",function(){it("returns port 80 for non tls node request",function(e){var t={method:"POST",url:"/resource/4?filter=a",headers:{host:"example.com","content-type":"text/plain;x=y"}};expect(Hawk.utils.parseHost(t,"Host").port).to.equal(80),e()}),it("returns port 443 for non tls node request",function(e){var t={method:"POST",url:"/resource/4?filter=a",headers:{host:"example.com","content-type":"text/plain;x=y"},connection:{encrypted:!0}};expect(Hawk.utils.parseHost(t,"Host").port).to.equal(443),e()}),it("returns port 443 for non tls node request (IPv6)",function(e){var t={method:"POST",url:"/resource/4?filter=a",headers:{host:"[123:123:123]","content-type":"text/plain;x=y"},connection:{encrypted:!0}};expect(Hawk.utils.parseHost(t,"Host").port).to.equal(443),e()}),it("parses IPv6 headers",function(e){var t={method:"POST",url:"/resource/4?filter=a",headers:{host:"[123:123:123]:8000","content-type":"text/plain;x=y"},connection:{encrypted:!0}},o=Hawk.utils.parseHost(t,"Host");expect(o.port).to.equal("8000"),expect(o.name).to.equal("[123:123:123]"),e()}),it("errors on header too long",function(e){for(var t="",o=0;5e3>o;++o)t+="x";expect(Hawk.utils.parseHost({headers:{host:t}})).to.be.null(),e()})}),describe("parseAuthorizationHeader()",function(){it("errors on header too long",function(e){for(var t='Scheme a="',o=0;5e3>o;++o)t+="x";t+='"';var r=Hawk.utils.parseAuthorizationHeader(t,["a"]);expect(r).to.be.instanceof(Error),expect(r.message).to.equal("Header length too long"),e()})}),describe("version()",function(){it("returns the correct package version number",function(e){expect(Hawk.utils.version()).to.equal(Package.version),e()})}),describe("unauthorized()",function(){it("returns a hawk 401",function(e){expect(Hawk.utils.unauthorized("kaboom").output.headers["WWW-Authenticate"]).to.equal('Hawk error="kaboom"'),e()}),it("supports attributes",function(e){expect(Hawk.utils.unauthorized("kaboom",{a:"b"}).output.headers["WWW-Authenticate"]).to.equal('Hawk a="b", error="kaboom"'),e()})})});