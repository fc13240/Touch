function priv(t,e,i){var r;return symbols[e]?r=symbols[e]:(r=makeSymbol(e),symbols[e]=r),2===arguments.length?t[r]:(t[r]=i,i)}function naiveLength(){return 1}function LRUCache(t){if(!(this instanceof LRUCache))return new LRUCache(t);"number"==typeof t&&(t={max:t}),t||(t={});var e=priv(this,"max",t.max);(!e||"number"!=typeof e||0>=e)&&priv(this,"max",1/0);var i=t.length||naiveLength;"function"!=typeof i&&(i=naiveLength),priv(this,"lengthCalculator",i),priv(this,"allowStale",t.stale||!1),priv(this,"maxAge",t.maxAge||0),priv(this,"dispose",t.dispose),this.reset()}function forEachStep(t,e,i,r){var n=i.value;isStale(t,n)&&(del(t,i),priv(t,"allowStale")||(n=void 0)),n&&e.call(r,n.value,n.key,t)}function get(t,e,i){var r=priv(t,"cache").get(e);if(r){var n=r.value;isStale(t,n)?(del(t,r),priv(t,"allowStale")||(n=void 0)):i&&priv(t,"lruList").unshiftNode(r),n&&(n=n.value)}return n}function isStale(t,e){if(!e||!e.maxAge&&!priv(t,"maxAge"))return!1;var i=!1,r=Date.now()-e.now;return i=e.maxAge?r>e.maxAge:priv(t,"maxAge")&&r>priv(t,"maxAge")}function trim(t){if(priv(t,"length")>priv(t,"max"))for(var e=priv(t,"lruList").tail;priv(t,"length")>priv(t,"max")&&null!==e;){var i=e.prev;del(t,e),e=i}}function del(t,e){if(e){var i=e.value;priv(t,"dispose")&&priv(t,"dispose").call(this,i.key,i.value),priv(t,"length",priv(t,"length")-i.length),priv(t,"cache").delete(i.key),priv(t,"lruList").removeNode(e)}}function Entry(t,e,i,r,n){this.key=t,this.value=e,this.length=i,this.now=r,this.maxAge=n||0}module.exports=LRUCache;var Map=require("pseudomap"),util=require("util"),Yallist=require("yallist"),symbols={},hasSymbol="function"==typeof Symbol,makeSymbol;makeSymbol=hasSymbol?function(t){return Symbol.for(t)}:function(t){return"_"+t},Object.defineProperty(LRUCache.prototype,"max",{set:function(t){(!t||"number"!=typeof t||0>=t)&&(t=1/0),priv(this,"max",t),trim(this)},get:function(){return priv(this,"max")},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"allowStale",{set:function(t){priv(this,"allowStale",!!t)},get:function(){return priv(this,"allowStale")},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"maxAge",{set:function(t){(!t||"number"!=typeof t||0>t)&&(t=0),priv(this,"maxAge",t),trim(this)},get:function(){return priv(this,"maxAge")},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"lengthCalculator",{set:function(t){"function"!=typeof t&&(t=naiveLength),t!==priv(this,"lengthCalculator")&&(priv(this,"lengthCalculator",t),priv(this,"length",0),priv(this,"lruList").forEach(function(t){t.length=priv(this,"lengthCalculator").call(this,t.value,t.key),priv(this,"length",priv(this,"length")+t.length)},this)),trim(this)},get:function(){return priv(this,"lengthCalculator")},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"length",{get:function(){return priv(this,"length")},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"itemCount",{get:function(){return priv(this,"lruList").length},enumerable:!0}),LRUCache.prototype.rforEach=function(t,e){e=e||this;for(var i=priv(this,"lruList").tail;null!==i;){var r=i.prev;forEachStep(this,t,i,e),i=r}},LRUCache.prototype.forEach=function(t,e){e=e||this;for(var i=priv(this,"lruList").head;null!==i;){var r=i.next;forEachStep(this,t,i,e),i=r}},LRUCache.prototype.keys=function(){return priv(this,"lruList").toArray().map(function(t){return t.key},this)},LRUCache.prototype.values=function(){return priv(this,"lruList").toArray().map(function(t){return t.value},this)},LRUCache.prototype.reset=function(){priv(this,"dispose")&&priv(this,"lruList")&&priv(this,"lruList").length&&priv(this,"lruList").forEach(function(t){priv(this,"dispose").call(this,t.key,t.value)},this),priv(this,"cache",new Map),priv(this,"lruList",new Yallist),priv(this,"length",0)},LRUCache.prototype.dump=function(){return priv(this,"lruList").map(function(t){return isStale(this,t)?void 0:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}},this).toArray().filter(function(t){return t})},LRUCache.prototype.dumpLru=function(){return priv(this,"lruList")},LRUCache.prototype.inspect=function(t,e){var i="LRUCache {",r=!1,n=priv(this,"allowStale");n&&(i+="\n  allowStale: true",r=!0);var a=priv(this,"max");a&&1/0!==a&&(r&&(i+=","),i+="\n  max: "+util.inspect(a,e),r=!0);var h=priv(this,"maxAge");h&&(r&&(i+=","),i+="\n  maxAge: "+util.inspect(h,e),r=!0);var s=priv(this,"lengthCalculator");s&&s!==naiveLength&&(r&&(i+=","),i+="\n  length: "+util.inspect(priv(this,"length"),e),r=!0);var l=!1;return priv(this,"lruList").forEach(function(t){l?i+=",\n  ":(r&&(i+=",\n"),l=!0,i+="\n  ");var n=util.inspect(t.key).split("\n").join("\n  "),a={value:t.value};t.maxAge!==h&&(a.maxAge=t.maxAge),s!==naiveLength&&(a.length=t.length),isStale(this,t)&&(a.stale=!0),a=util.inspect(a,e).split("\n").join("\n  "),i+=n+" => "+a}),(l||r)&&(i+="\n"),i+="}"},LRUCache.prototype.set=function(t,e,i){i=i||priv(this,"maxAge");var r=i?Date.now():0,n=priv(this,"lengthCalculator").call(this,e,t);if(priv(this,"cache").has(t)){if(n>priv(this,"max"))return del(this,priv(this,"cache").get(t)),!1;var a=priv(this,"cache").get(t),h=a.value;return priv(this,"dispose")&&priv(this,"dispose").call(this,t,h.value),h.now=r,h.maxAge=i,h.value=e,priv(this,"length",priv(this,"length")+(n-h.length)),h.length=n,this.get(t),trim(this),!0}var s=new Entry(t,e,n,r,i);return s.length>priv(this,"max")?(priv(this,"dispose")&&priv(this,"dispose").call(this,t,e),!1):(priv(this,"length",priv(this,"length")+s.length),priv(this,"lruList").unshift(s),priv(this,"cache").set(t,priv(this,"lruList").head),trim(this),!0)},LRUCache.prototype.has=function(t){if(!priv(this,"cache").has(t))return!1;var e=priv(this,"cache").get(t).value;return isStale(this,e)?!1:!0},LRUCache.prototype.get=function(t){return get(this,t,!0)},LRUCache.prototype.peek=function(t){return get(this,t,!1)},LRUCache.prototype.pop=function(){var t=priv(this,"lruList").tail;return t?(del(this,t),t.value):null},LRUCache.prototype.del=function(t){del(this,priv(this,"cache").get(t))},LRUCache.prototype.load=function(t){this.reset();for(var e=Date.now(),i=t.length-1;i>=0;i--){var r=t[i],n=r.e||0;if(0===n)this.set(r.k,r.v);else{var a=n-e;a>0&&this.set(r.k,r.v,a)}}},LRUCache.prototype.prune=function(){var t=this;priv(this,"cache").forEach(function(e,i){get(t,i,!1)})};